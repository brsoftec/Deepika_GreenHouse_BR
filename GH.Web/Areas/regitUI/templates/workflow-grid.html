<div class="user-grid">

    <div class="interaction-dashboard workflow-dashboard">
        <button type="button" class="interaction-cta cta-add-member workflow-cta-add-member expandable"
               ng-class="{collapsable: view.showingAddMember}" ng-disabled="!canWrite || view.showingQuotaReached" ng-click="toggleAddMember()">
            Add Member
        </button>

        <button type="button" class="interaction-cta cta-workflow-permissions last-in-group"
               ng-click="viewPermissions()">
            Roles &amp; Permissions
        </button>
    </div>

    <div class="billing-quota-container" ng-if="view.showingQuotaReached" >
        <div class="billing-quota-alert">
            <p>Your usage has reached limit of {{subscription.plan.businessMembers}} business members, as imposed by {{subscription.plan.label}}.</p>
            <p><a href="/BusinessAccount/Billing">Upgrade your plan</a> to add more.</p>
        </div>
    </div>

    <user-select ng-if="view.showingAddMember" type="workflow" class="expandable-user-select workflow-user-select" ignores="users" invites="invites" on-add="inviteMember(user)"></user-select>

    <div ng-if="!view.loaded">Loading business members...</div>
    <div ng-if="view.loaded && !users.length">No member in your business</div>

    <table ng-if="users.length" class="table">
        <tbody>
        <tr ng-repeat-start="user in users | orderBy:sortUsers" ng-class="{even: $index%2}">
            <td class="user-avatar-cell">
                <a ng-if="user.profileUrl" href="{{user.profileUrl}}">
                    <img class="img-thumbnail" ng-src="{{user.avatar | avatarUrl}}">
                </a>
                <img class="img-thumbnail" ng-if="!user.profileUrl" ng-src="{{user.avatar | avatarUrl}}">
            </td>
            <td class="user-name-cell">
                <a ng-if="user.profileUrl" href="{{user.profileUrl}}">{{user.displayName}}</a>
                <span ng-if="!user.profileUrl">{{user.displayName}}</span>
            </td>
            <td class="user-role-cell">
                <div ng-if="user.pending" class="badge-pending">Pending</div>
                <div ng-repeat="role in user.roles" class="workflow-user-role">
                    <span ng-bind="role.name" class="workflow-role-badge role-{{role.name}}"></span>
                </div>
            </td>
            <td class="user-info-cell">
                <span ng-if="user.pending && !user.inviteId">Invitation sent {{user.invitation.SentAt | friendlyTime}}</span>
                <span ng-if="user.pending && user.inviteId">Signed up {{user.invitation.SentAt | friendlyTime}}<br>following your email invitation</span>
            </td>

            <td class="user-grid-actions">
                <button type="button" ng-if="view.editing && view.editingUser.id === user.id"
                        class="grid-action action-save" ng-click="saveEdit(user,$event)">Save
                </button>
                <button type="button" ng-if="view.editing && view.editingUser.id === user.id"
                        class="grid-action action-cancel" ng-click="cancelEdit(user,$event)">Cancel
                </button>
            </td>

            <td class="more-actions">
                <button class="grid-action action-more"
                        ng-click="rguView.openMoreActions(user.id,$event)">More
                </button>
                <div class="more-actions-dropdown has-prefix" ng-if="rguView.isOpenMoreActions(user.id)">
                    <button ng-if="!user.pending && canWrite" class="more-action" ng-click="beginEdit(user,$event)">Edit</button>
                    <button ng-if="!user.pending && !canWrite" class="more-action action-unauthorized">Edit</button>
                    <!--<button ng-if="user.pending" class="more-action" ng-click="resendRequest(user)">Resend Invitation-->
                    <!--</button>-->
                    <button ng-if="user.pending && canWrite" class="more-action" ng-click="cancelRequest(user)">Cancel Invitation
                    </button>
                    <button ng-if="user.pending && !canWrite" class="more-action action-unauthorized">Cancel Invitation</button>
                    <button ng-if="!user.pending && canWrite" class="more-action" ng-click="removeUser(user)">Remove Member
                    </button>
                    <button ng-if="!user.pending && !canWrite" class="more-action action-unauthorized">Remove Member</button>
                </div>
            </td>
        </tr>

        <tr ng-repeat-end ng-class="{even: $index%2}">
            <td ng-if="view.editing && view.editingUser.id === user.id" colspan="6" class="user-edit-cell">
                <div class="user-edit workflow-edit">
                        <div class="workflow-edit-label">Roles</div>
                        <div class="workflow-edit-field">
                            <rgu-checkbox label="Admin" ng-model="view.editingUser.roleModel.admin"></rgu-checkbox>
                            <rgu-checkbox label="Editor" ng-model="view.editingUser.roleModel.editor"></rgu-checkbox>
                            <rgu-checkbox label="Approver" ng-model="view.editingUser.roleModel.approver"></rgu-checkbox>
                        </div>
                </div>
            </td>
        </tr>
        </tbody>

    </table>

    <invite-grid type="workflow" invites="invites"></invite-grid>


</div>

